<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.png"/>
	<link rel="shortcut icon" href="/img/logo_miccall.png">
	
			    <title>
    Hexo
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="miccall" />
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.png') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<meta name="generator" content="Hexo 7.2.0"></head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">bamboo</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url();background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >Angular2学习笔记-响应式编程与Rxjs</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h2 id="什么是响应式编程"><a href="#什么是响应式编程" class="headerlink" title="什么是响应式编程"></a>什么是响应式编程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">//什么是响应式编程</span><br><span class="line">//面向数据流与变化传播的编程范式。针对数据多异步，多变化的场景下的产物</span><br><span class="line">//特点：最初的数据会随着后续对应变量的变化而变化</span><br><span class="line"></span><br><span class="line">//RX：Reactive Extensions。由微软开发维护。有java,等版本</span><br><span class="line"></span><br><span class="line">//Rxjs的核心概念是observable。将异步数据流包装成observeble对象，然后结合Rx的方法对数据进行流水线处理，即链式调用</span><br><span class="line">//Rxjs从功能上来讲可以当做Promise的超集，能够处理更加复杂的异步场景，但同时对开发人员的抽象能力要求也比较高</span><br><span class="line"></span><br><span class="line">//Rx结合了观察者模式，需要使用者订阅。同时结合了函数式编程与迭代器模式的思想</span><br><span class="line">//例：</span><br><span class="line">let newObservable=Observable.debounceTime(500).take(2);</span><br><span class="line">//debuounceTime()与take()都是operator</span><br><span class="line">Observable.subscribe(observe);</span><br><span class="line"></span><br><span class="line">//observable发送一个事件，事件会被observer捕获，并进入到回调。subscribe不是一个可以改变原始数据流的函数，其会返回一个Subscription实例，其本身有多个API操作。</span><br><span class="line"></span><br><span class="line">//使用RxJSc处理用户输入查询然后显示匹配提示的场景：</span><br><span class="line">//一般的要求使用ngchange监听然后发送请求，最后返回的数据进行渲染。</span><br><span class="line">//但考虑到下面的细节时就比较复杂：</span><br><span class="line">/**</span><br><span class="line"> * 1、不输入用户每输入一个字符就立马请求数据，减少服务器压力。可以在确认用户500ms没有输入了则请求数据</span><br><span class="line"> * 2、用户输入相同的字符不请求</span><br><span class="line"> * 3、每次匹配请求返回数据不一定是顺序返回的，第一次的搜索可能会比第二次搜索返回晚。这样显示的数据会是混乱的。</span><br><span class="line"> */</span><br><span class="line">//使用一般的js处理会有许多状态量去控制，但是使用RxJs会比较清晰优雅。</span><br><span class="line">let inputSelector=document.querySelector(&#x27;input&#x27;);</span><br><span class="line">RegExp.Observable.formEvent(inputSelector,&#x27;keyup&#x27;)</span><br><span class="line">    .debounceTime(500)</span><br><span class="line">    .switchMap(event=&gt;getRecommend(event.target.value))</span><br><span class="line">    .subscribe(callback);</span><br><span class="line"></span><br><span class="line">//RxJs的operator</span><br><span class="line">/**</span><br><span class="line"> * Observable.create() //创建操作符  接受工厂函数返回一个新的Observble对象，可以被subscribe</span><br><span class="line"> * Observable.map()    //变换操作符  对数据进行调整</span><br><span class="line"> * Observable.filter() //过滤操作符  对数据过滤，返回false将终止传播</span><br><span class="line"> * Observable.forkJoin() //组合操作符   组合多个接口的数据，可以处理多个接口请求的数据，同时这些接口可以有依赖性</span><br><span class="line"> * Observable.timeout()等工具操作符</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> //使用Rxjs改造HTTP服务</span><br><span class="line"> /**</span><br><span class="line">  * 1、对请求结果进行统一的预处理</span><br><span class="line">    2、对捕获的错误统一处理</span><br><span class="line">    3、请求发起，加载动画</span><br><span class="line">    4、请求结束，关闭动画</span><br><span class="line">  */</span><br><span class="line"></span><br><span class="line">import &#123;Injectable&#125; from &#x27;@angular/core&#x27;;</span><br><span class="line">import &#123;Http,RequestOptions,Headers&#125; from   &#x27;@angular/http&#x27;;</span><br><span class="line">import &#123;Observable&#125; from &#x27;rxjs/Rx&#x27;;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line">export class MyHttpService&#123;</span><br><span class="line">    constructor(private http:Http)&#123;</span><br><span class="line">    &#125;</span><br><span class="line">     //get方法，统一调用request方法</span><br><span class="line">     get(url:string,reqOpts?:RequestOptions)&#123;</span><br><span class="line">         return this.request(url,Object.assign(&#123;</span><br><span class="line">             method:&#x27;get&#x27;</span><br><span class="line">         &#125;,reqOpts))</span><br><span class="line">     &#125;</span><br><span class="line">     //</span><br><span class="line">     request(url:string,reqOpts:RequestOptions)&#123;</span><br><span class="line">         this.shoLoading();</span><br><span class="line">         return this.http.request(url,new RequestOptions(reqOpts))</span><br><span class="line">            .map(res=&gt;res.json)  </span><br><span class="line">            .do(this.hideLoading.bind(this))</span><br><span class="line">            .map(this.preprocessRes.bind(this))</span><br><span class="line">            .catch(this.handleErr.bind(this));</span><br><span class="line">     &#125;</span><br><span class="line">     private preprocessRes(res)&#123;</span><br><span class="line">         //..进行数据预处理</span><br><span class="line">         return res.data;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line">//RxJs的observable是‘冷’模式，需要被订阅，定义的代码才会执行。</span><br><span class="line"></span><br><span class="line">//使用RxJs解决输入提示功能</span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector:&#x27;demo-input&#x27;,</span><br><span class="line">    template:`</span><br><span class="line">        &lt;input  type=&quot;text&quot; [ngFormControl]=&quot;term&quot;/&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;li *ngFor=&quot;let recommend of recommends&quot;&gt;&#123;&#123;recommend&#125;&#125;&lt;/li&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    `,</span><br><span class="line">    provider:[DemoService]</span><br><span class="line">&#125;)</span><br><span class="line">export class DemoInput implements OnInit&#123;</span><br><span class="line">    recommends:Array&lt;string&gt;;</span><br><span class="line">    term=new Control();</span><br><span class="line">    constructor(private _demoService:DemoService)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    ngOnInit()&#123;</span><br><span class="line">        this.term.valueChanges</span><br><span class="line">            .debuounceTime(500)//延迟500ms  过滤掉所有Observable对象抛出的时间间隔不超过500ms的事件</span><br><span class="line">            .distinctUntilChanged()//检验输入值是否变化,过滤掉Observable对象连续抛出的value值相同的事件</span><br><span class="line">            .switchMap(term=&gt;this._demoService.getRecommend(term))//保证请求顺序 ，接受了另一个Observable对象，每一个value边改的时间会被</span><br><span class="line">            //映射成一个新的Observable对象，当上流有新数据，那么switchMap里生成的数据流会被截断。那么过时的数据不会被传输</span><br><span class="line">            .subscribe(items=&gt;&#123;//this.term.valueChanges是一个Observable对象</span><br><span class="line">            this.items=items;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
            </div>

            <!-- Post Comments -->
            

        </div>
        <!-- Copyright 版权 start -->
        
    </div>
</body>



 	
</html>
